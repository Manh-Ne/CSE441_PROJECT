package com.example.project.ui;

import android.os.Bundle;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import androidx.viewpager2.widget.ViewPager2;

import com.example.project.R;
import com.example.project.adapter.PageAdapter;

import java.util.ArrayList;
import java.util.List;

public class ReadBook extends AppCompatActivity {

    private List<String> pages;
    private TextView textViewPageNumber;
    private ViewPager2 viewPager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_read_book);

        textViewPageNumber = findViewById(R.id.textViewPageNumber);
        viewPager = findViewById(R.id.viewPager);

        // Nội dung sách dài để test
        String bookContent = "Trong một ngôi làng nhỏ nằm ở giữa rừng xanh, có một cậu bé tên là An. An rất thích khám phá những điều mới lạ và luôn tìm kiếm những cuộc phiêu lưu. Một ngày nọ, An quyết định đi sâu vào rừng để tìm hiểu về những bí ẩn mà mọi người thường kể. Cậu bắt đầu hành trình của mình với một chiếc ba lô nhỏ, bên trong có bánh mì, nước và một cuốn sách. \n\nKhi An bước vào rừng, cậu cảm thấy không khí trong lành và mát mẻ. Tiếng chim hót líu lo và những tia nắng chiếu xuyên qua tán lá cây tạo nên một khung cảnh tuyệt đẹp. Cậu đi sâu hơn và phát hiện ra một con đường nhỏ dẫn đến một khu rừng rậm rạp. \n\nCàng đi sâu vào rừng, An càng cảm thấy hồi hộp. Cậu gặp một con cáo đang ngồi bên lề đường. Con cáo nhìn An và nói: “Chào bạn, bạn có muốn biết về những bí mật của rừng này không?” An rất ngạc nhiên nhưng cậu quyết định gật đầu đồng ý. \n\nCon cáo dẫn An đến một khu vực mà cậu chưa bao giờ thấy trước đây. Ở đó, có những cây cổ thụ lớn, hoa lá nở rực rỡ và một hồ nước trong xanh. Cậu ngồi xuống bên bờ hồ, thưởng thức chiếc bánh mì và nhìn ngắm vẻ đẹp của thiên nhiên. \n\n“Rừng này có rất nhiều bí ẩn,” con cáo nói, “nếu bạn thật sự muốn khám phá, bạn cần phải dũng cảm.” An cảm thấy tim mình đập mạnh. Cậu quyết định sẽ không sợ hãi và tiếp tục hành trình. \n\nSau nhiều giờ khám phá, An đã học được rất nhiều điều về rừng, từ các loài cây, hoa, đến các loài động vật. Cậu không chỉ tìm thấy những điều mới lạ mà còn cảm thấy lòng mình tràn đầy sự thích thú và hào hứng. Cuối cùng, An trở về nhà với một trái tim đầy kỷ niệm và một tinh thần khám phá không bao giờ ngừng nghỉ.";

        // Chia nội dung thành các trang (100 ký tự mỗi trang để kiểm tra)
        pages = splitContentIntoPages(bookContent, 100);

        // Thiết lập Adapter cho ViewPager2
        PageAdapter adapter = new PageAdapter(pages);
        viewPager.setAdapter(adapter);

        // Cập nhật số trang khi người dùng vuốt
        viewPager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {
            @Override
            public void onPageSelected(int position) {
                super.onPageSelected(position);
                textViewPageNumber.setText("Trang " + (position + 1) + "/" + pages.size());
            }
        });
    }

    private List<String> splitContentIntoPages(String content, int pageSize) {
        List<String> pages = new ArrayList<>();
        int start = 0;
        while (start < content.length()) {
            int end = Math.min(start + pageSize, content.length());
            pages.add(content.substring(start, end));
            start += pageSize;
        }
        return pages;
    }
}
